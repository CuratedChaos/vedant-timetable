<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Timetable</title>
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#7b2ff7" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Poppins',sans-serif;
      background:linear-gradient(135deg,#7b2ff7,#f107a3,#0fdaf5);
      background-size:400% 400%;
      animation:bgMove 12s ease infinite;
      color:#fff;
      display:flex;
      flex-direction:column;
      align-items:center;
      min-height:100vh;
      overflow-x:hidden;
    }
    @keyframes bgMove{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }

    .analog{
      position:fixed;
      top:15px;right:25px;
      width:90px;height:90px;
      border:3px solid rgba(255,255,255,0.8);
      border-radius:50%;
    }
    .hand{
      position:absolute;
      top:50%;left:50%;
      transform-origin:bottom center;
      transform:translate(-50%,-100%) rotate(0deg);
      background:#fff;
      border-radius:2px;
    }
    .hand.hour{width:4px;height:25px;background:#fff;}
    .hand.min{width:3px;height:35px;background:#e0e0e0;}
    .hand.sec{width:2px;height:40px;background:#f8d210;}

    .settings{position:fixed;top:15px;left:25px;}
    select,button{
      background:rgba(255,255,255,0.2);
      color:#fff;border:none;
      border-radius:8px;padding:5px 10px;
      backdrop-filter:blur(6px);
    }

    .timer{
      margin-top:110px;
      font-size:5rem;
      font-weight:700;
      padding:20px 50px;
      border-radius:25px;
      background:rgba(255,255,255,0.15);
      box-shadow:0 0 20px rgba(255,255,255,0.3);
    }
    .ongoing,.next{
      margin-top:15px;
      font-size:1.3rem;
      text-align:center;
      background:rgba(255,255,255,0.2);
      padding:10px 25px;
      border-radius:15px;
      backdrop-filter:blur(5px);
    }
    .grid{
      margin-top:50px;
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:15px;
      width:95%;
      max-width:1000px;
    }
    .day-card{
      background:rgba(255,255,255,0.15);
      border-radius:15px;
      padding:12px;
      backdrop-filter:blur(8px);
    }
    .day-card.highlight{
      box-shadow:0 0 20px rgba(255,255,255,0.6);
    }
    .slot{
      margin-top:8px;
      background:rgba(255,255,255,0.15);
      border-radius:10px;
      padding:8px;
    }
    .sub{font-size:1rem;font-weight:700;}
    .time{font-size:0.85rem;opacity:0.9;}
    .fac{font-size:0.8rem;opacity:0.7;}
  </style>
</head>
<body>
  <div class="analog">
    <div class="hand hour" id="hour"></div>
    <div class="hand min" id="min"></div>
    <div class="hand sec" id="sec"></div>
  </div>

  <div class="settings">
    Batch:
    <select id="batch"><option value="D1">D1</option><option value="D3">D3</option></select>
    <button onclick="saveBatch()">Save</button>
  </div>

  <div class="timer" id="timer">--:--</div>
  <div class="ongoing" id="ongoing">Ongoing: None</div>
  <div class="next" id="next">Next: --</div>

  <div class="grid" id="timetable"></div>

  <script>
    const schedule={
      D1:{
        Monday:[
          ["09:15","10:05","LAUC(SC)","A207"],
          ["10:05","10:55","BXE(PP)","A207"],
          ["10:55","11:05","Short Break",""],
          ["11:05","11:55","EG(AD)","A207"],
          ["11:55","12:45","CHEM(MD)","A207"],
          ["12:45","13:30","Lunch Break",""],
          ["13:30","15:10","Yoga(SP)","MPH"],
          ["15:10","16:00","CHEM(MD)","A207"]
        ],
        Tuesday:[
          ["09:15","10:05","LAUC(SC)","A207"],
          ["10:05","10:55","CP(YK)","A207"],
          ["10:55","11:05","Short Break",""],
          ["11:05","12:45","CHEM(MD)","A111"],
          ["12:45","13:30","Lunch Break",""],
          ["13:30","15:10","CP(YK)","A210"],
          ["15:10","16:00","CHEM(MD)","A207"]
        ],
        Wednesday:[
          ["09:15","10:55","LAUC(MT)","A206"],
          ["10:55","11:05","Short Break",""],
          ["11:05","11:55","PC(AK)","A206"],
          ["11:55","12:45","LAUC(SC)","A206"],
          ["12:45","13:30","Lunch Break",""],
          ["13:30","14:20","BXE(PP)","A206"],
          ["14:20","15:10","Japanese Language","A206"],
          ["15:10","16:00","EG(AD)","A206"]
        ],
        Thursday:[
          ["09:15","10:05","LAUC(SC)","A207"],
          ["10:05","10:55","CP(YK)","A207"],
          ["10:55","11:05","Short Break",""],
          ["11:05","12:45","MMF(AD)","WS"],
          ["12:45","13:30","Lunch Break",""],
          ["13:30","15:10","BXE(PP)","A212"],
          ["15:10","16:00","Japanese Language","A204"]
        ],
        Friday:[
          ["09:15","10:05","EG(AD)","A207"],
          ["10:05","10:55","BXE(PP)","A207"],
          ["10:55","11:05","Short Break",""],
          ["11:05","11:55","CHEM(MD)","A207"],
          ["11:55","12:45","CP(YK)","A207"],
          ["12:45","13:30","Lunch Break",""],
          ["13:30","15:10","Mentoring/Dept Meeting",""],
          ["15:10","16:00","TED Talk",""]
        ],
        Saturday:[
          ["09:15","10:05","VAP",""],
          ["10:05","10:55","VAP",""],
          ["10:55","11:05","Short Break",""],
          ["11:05","11:55","VAP",""],
          ["11:55","12:45","VAP",""],
          ["12:45","13:30","Lunch Break",""],
          ["13:30","14:20","Club Activity",""],
          ["14:20","15:10","Club Activity",""],
          ["15:10","16:00","Club Activity",""]
        ]
      },
      D3:{
        Monday:[
          ["09:15","10:05","LAUC(SC)","A207"],
          ["10:05","10:55","BXE(PP)","A207"],
          ["10:55","11:05","Short Break",""],
          ["11:05","11:55","EG(AD)","A207"],
          ["11:55","12:45","CHEM(MD)","A207"],
          ["12:45","13:30","Lunch Break",""],
          ["13:30","15:10","CP(YK)","A414"],
          ["15:10","16:00","CHEM(MD)","A207"]
        ],
        Tuesday:[
          ["09:15","10:05","LAUC(SC)","A207"],
          ["10:05","10:55","CP(YK)","A207"],
          ["10:55","11:05","Short Break",""],
          ["11:05","12:45","LAUC(MT)","A213"],
          ["12:45","13:30","Lunch Break",""],
          ["13:30","15:10","MMF(AD)","WS"],
          ["15:10","16:00","CHEM(MD)","A207"]
        ],
        Wednesday:[
          ["09:15","10:55","BXE(PP)","A212"],
          ["10:55","11:05","Short Break",""],
          ["11:05","11:55","PC(AK)","A206"],
          ["11:55","12:45","LAUC(SC)","A206"],
          ["12:45","13:30","Lunch Break",""],
          ["13:30","14:20","BXE(PP)","A206"],
          ["14:20","15:10","Japanese Language","A206"],
          ["15:10","16:00","EG(AD)","A206"]
        ],
        Thursday:[
          ["09:15","10:05","LAUC(SC)","A207"],
          ["10:05","10:55","CP(YK)","A207"],
          ["10:55","11:05","Short Break",""],
          ["11:05","12:45","Yoga(SP)","MPH"],
          ["12:45","13:30","Lunch Break",""],
          ["13:30","15:10","CHEM(MD)","A111"],
          ["15:10","16:00","Japanese Language","A204"]
        ],
        Friday:[
          ["09:15","10:05","EG(AD)","A207"],
          ["10:05","10:55","BXE(PP)","A207"],
          ["10:55","11:05","Short Break",""],
          ["11:05","11:55","CHEM(MD)","A207"],
          ["11:55","12:45","CP(YK)","A207"],
          ["12:45","13:30","Lunch Break",""],
          ["13:30","15:10","Mentoring/Dept Meeting",""],
          ["15:10","16:00","TED Talk",""]
        ],
        Saturday:[
          ["09:15","10:05","VAP",""],
          ["10:05","10:55","VAP",""],
          ["10:55","11:05","Short Break",""],
          ["11:05","11:55","VAP",""],
          ["11:55","12:45","VAP",""],
          ["12:45","13:30","Lunch Break",""],
          ["13:30","14:20","Club Activity",""],
          ["14:20","15:10","Club Activity",""],
          ["15:10","16:00","Club Activity",""]
        ]
      }
    };

    function toMinutes(t){const [h,m]=t.split(":").map(Number);return h*60+m;}

    function findLecture(batch){
      const dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
      const today=new Date();const day=dayNames[today.getDay()];
      const nowM=today.getHours()*60+today.getMinutes();
      const timetable=schedule[batch][day];
      if(!timetable)return{ongoing:null,next:null};
      let ongoing=null,next=null;
      for(let i=0;i<timetable.length;i++){
        const [s,e]=timetable[i];
        const sm=toMinutes(s),em=toMinutes(e);
        if(nowM>=sm&&nowM<em)ongoing=timetable[i];
        if(nowM<sm&&!next)next=timetable[i];
      }
      return{ongoing,next};
    }

    function updateLecture(){
      const batch=localStorage.getItem("batch")||document.getElementById("batch").value;
      const {ongoing,next}=findLecture(batch);
      const now=new Date();
      if(ongoing){
        document.getElementById("ongoing").textContent=`Ongoing: ${ongoing[2]} (${ongoing[3]||""})`;
        const rem=toMinutes(ongoing[1])-(now.getHours()*60+now.getMinutes());
        const mm=String(rem%60).padStart(2,"0");
        const hh=String(Math.floor(rem/60)).padStart(2,"0");
const ss = String(now.getSeconds()).padStart(2, "0");
document.getElementById("timer").textContent = `${hh}:${mm}:${ss}`;
      }else{
        document.getElementById("ongoing").textContent="Finally over ðŸ˜‚";
        document.getElementById("timer").textContent="--:--";
      }
      if(next)document.getElementById("next").textContent=`Next: ${next[2]} (${next[3]||""}) at ${next[0]}`;
      else document.getElementById("next").textContent="Next: None";
    }

    function renderTable(batch){
      const grid=document.getElementById("timetable");
      grid.innerHTML="";
      const timetable=schedule[batch];
      const today=new Date().getDay();
      const days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
      days.forEach((d,i)=>{
        const card=document.createElement("div");
        card.className="day-card"+(i+1===today?" highlight":"");
        const title=document.createElement("div");
        title.innerHTML=`<b>${d}</b>`;
        card.appendChild(title);
        (timetable[d]||[]).forEach(slot=>{
          const div=document.createElement("div");
          div.className="slot";
          div.innerHTML=`<div class='sub'>${slot[2]}</div><div class='time'>${slot[0]}-${slot[1]}</div><div class='fac'>${slot[3]}</div>`;
          card.appendChild(div);
        });
        grid.appendChild(card);
      });
    }

    function saveBatch(){
      const b=document.getElementById("batch").value;
      localStorage.setItem("batch",b);
      renderTable(b);
    }

    function analogClock(){
      const now=new Date();
      const sec=now.getSeconds(),min=now.getMinutes(),hr=now.getHours()%12;
      document.getElementById("sec").style.transform=`translate(-50%,-100%) rotate(${sec*6}deg)`;
      document.getElementById("min").style.transform=`translate(-50%,-100%) rotate(${min*6}deg)`;
      document.getElementById("hour").style.transform=`translate(-50%,-100%) rotate(${(hr*30)+(min/2)}deg)`;
    }

    function init(){
      const b=localStorage.getItem("batch")||"D1";
      document.getElementById("batch").value=b;
      renderTable(b);
      updateLecture();
      analogClock();
      setInterval(updateLecture,60000);
      setInterval(analogClock,1000);
    }

    window.onload=init;
    // === Confetti burst after 4 PM ===
function launchConfetti(){
  const now = new Date();
  const currentSeconds = now.getHours()*3600 + now.getMinutes()*60 + now.getSeconds();
  const endOfDay = 16*3600; // 4:00 PM

  // Only run if it's after 4 PM
  if (currentSeconds < endOfDay) return;

  const canvas = document.createElement("canvas");
  canvas.style.position = "fixed";
  canvas.style.top = "0";
  canvas.style.left = "0";
  canvas.style.width = "100%";
  canvas.style.height = "100%";
  canvas.style.pointerEvents = "none";
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  document.body.appendChild(canvas);

  const ctx = canvas.getContext("2d");
  const pieces = Array.from({ length: 160 }).map(() => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height * 0.3,
    r: Math.random() * 6 + 2,
    c: `hsl(${Math.random() * 360}, 90%, 55%)`,
    vx: (Math.random() - 0.5) * 6,
    vy: Math.random() * 4 + 2,
    rot: Math.random() * 360,
    vr: (Math.random() - 0.5) * 10,
  }));

  let start = null;
  function step(ts) {
    if (!start) start = ts;
    const t = ts - start;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    pieces.forEach((p) => {
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.vr;
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate((p.rot * Math.PI) / 180);
      ctx.fillStyle = p.c;
      ctx.fillRect(-p.r / 2, -p.r / 2, p.r, p.r);
      ctx.restore();
    });
    if (t < 7000) requestAnimationFrame(step); // 7 seconds
    else {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      canvas.remove();
    }
  }
  requestAnimationFrame(step);
}

// Run confetti automatically if college is over
window.addEventListener("load", () => {
  setTimeout(launchConfetti, 1000);
});

  </script>
</body>
</html>
